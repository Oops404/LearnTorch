import torch
import numpy as np

# çŸ©é˜µçš„å½¢å˜ä¸Žç‰¹æ®ŠçŸ©é˜µçš„æž„é€ æ–¹æ³•
'''
 torch.t tè½¬ç½®
 .eye åˆ›å»ºåŒ…å«Néš”åˆ†é‡çš„å•ä½çŸ©é˜µ
 .diag ä»¥t1ä¸­å„å…ƒç´ ï¼Œåˆ›å»ºå¯¹è§’çŸ©é˜µ
 .triu å–çŸ©é˜µtä¸­çš„ä¸Šä¸‰è§’çŸ©é˜µ
 .tril å–çŸ©é˜µtä¸­çš„ä¸‹ä¸‰è§’çŸ©é˜µ
'''

# åˆ›å»ºå•ä½çŸ©é˜µï¼Œç›¸å½“äºŽ1ï¼Œå•ä½çŸ©é˜µå·¦ä¹˜æˆ–è€…å³ä¹˜ä¸€ä¸ªçŸ©é˜µAï¼Œç»“æžœéƒ½ä¸ºA
torch.eye(3)

# å¯¹è§’çº¿çŸ©é˜µ
t1 = torch.arange(4)
torch.diag(t1)

# 1 å¯¹è§’çº¿ä¸Šå…ƒç´ ç»Ÿä¸€å¾€å³ä¸Šæ–¹ç§»åŠ¨ä¸€ä½, -1å·¦ä¸‹æ–¹åç§»ä¸€ä½
torch.diag(t1, 1)

# å–ä¸Šä¸‰è§’çŸ©é˜µ
torch.triu(t1)
# ä¸Šä¸‰è§’çŸ©é˜µå‘å·¦ä¸‹åç§»ä¸€ä½
torch.triu(t1, -1)
# ä¸Šä¸‰è§’çŸ©é˜µå‘å³ä¸Šåç§»ä¸€ä½
torch.triu(t1, 1)

# å–ä¸‹ä¸‰è§’çŸ©é˜µ
torch.tril(t1)

# çŸ©é˜µçš„åŸºæœ¬è¿ç®—
'''
 torch.dot è®¡ç®—å¼ é‡å†…ç§¯
 .mm çŸ©é˜µä¹˜æ³•
 .mv çŸ©é˜µä¹˜å‘é‡
 .bmm æ‰¹é‡çŸ©é˜µä¹˜æ³•
 .addmm(input,mat1,mat2,beta=1,alpha=1) çŸ©é˜µç›¸ä¹˜åŽç›¸åŠ 
    è¾“å‡ºç»“æžœ = beta * input + alpha * (mat1 * mat2)
 .addbmm æ‰¹é‡çŸ©é˜µç›¸ä¹˜åŽç›¸åŠ 
'''

# dot/vdot ç‚¹ç§¯è®¡ç®—
'''
æ³¨æ„ï¼Œåœ¨pytorchä¸­ï¼Œdotå’Œvdotåªèƒ½ä½œç”¨äºŽä¸€ç»´å¼ é‡ï¼Œä¸”å¯¹äºŽæ•°å€¼åž‹å¯¹è±¡ï¼Œ
äºŒè€…è®¡ç®—ç»“æžœå¹¶æ²¡æœ‰åŒºåˆ«ï¼Œä¸¤ç§å‡½æ•°åªåœ¨è¿›è¡Œå¤æ•°è¿ç®—æ—¶ï¼Œä¼šæœ‰åŒºåˆ«ã€‚

ç‚¹ç§¯ï¼Œå³ä¸¤ä¸ªå‘é‡å¯¹åº”ä½ç½®çš„å…ƒç´ ç›¸ä¹˜åŽç›¸åŠ 
'''
t2 = torch.arange(1, 4)
torch.dot(t2, t2)
torch.vdot(t2, t2)

t3 = torch.arange(1, 7).reshape(2, 3)
t4 = torch.arange(1, 10).reshape(2, 3)
# *ç¬¦å·ï¼Œå¯¹åº”ä½ç½®ç›¸ä¹˜
t3 * t4

# çŸ©é˜µä¹˜æ³•,å›žé¡¾ï¼šå·¦ä¹˜çŸ©é˜µçš„åˆ—æ•°å¿…é¡»ç­‰äºŽå³ä¹˜çŸ©é˜µçš„è¡Œæ•°
# ä¹˜æ³•è¿‡ç¨‹ï¼ŒA*Bï¼šAæ¯è¡Œä¹˜Bæ¯åˆ—åŽç›¸åŠ 
torch.mm(t3, t4)

# çŸ©é˜µå’Œå‘é‡ç›¸ä¹˜
met = torch.arange(1, 7).reshape(2, 3)
vec = torch.arange(1, 4)
# å®žé™…æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œéœ€è¦çŸ©é˜µçš„åˆ—æ•°å’Œå‘é‡çš„å…ƒç´ ä¸ªæ•°ç›¸åŒ
# è¿‡ç¨‹ï¼šå¯ä»¥æŠŠçŸ©é˜µçœ‹æˆNä¸ªå‘é‡æž„æˆçš„çŸ©é˜µã€‚ç„¶åŽçŸ©é˜µä¸­æ¯ä¸ªè¡Œå‘é‡å’Œè¢«ä¹˜å‘é‡åšç‚¹ç§¯
torch.mv(met, vec)
# åŒæ—¶ç­‰ä»·äºŽï¼šæŠŠè¢«ä¹˜å‘é‡è½¬æ¢æˆåˆ—å‘é‡ç„¶åŽå·¦ä¹˜çŸ©é˜µ
torch.mm(met, vec.reshape(3, 1))
torch.mm(met, vec.reshape(3, 1)).flatten()
'''
 mvçš„ç†è§£
 å…¶æœ¬è´¨ä¸Šæä¾›äº†ä¸€ç§äºŒç»´å¼ é‡äºŽä¸€ç»´å¼ é‡ç›¸ä¹˜çš„æ–¹æ³•ï¼Œåœ¨çº¿æ€§ä»£æ•°è¿ç®—
 è¿‡ç¨‹ä¸­ï¼Œæœ‰å¾ˆå¤šçŸ©é˜µä¹˜å‘é‡çš„åœºæ™¯ï¼Œå…¸åž‹çš„å¦‚çº¿æ€§å›žå½’çš„æ±‚è§£è¿‡ç¨‹ï¼Œé€šå¸¸
 æƒ…å†µä¸‹æˆ‘ä»¬éœ€è¦å°†å‘é‡è½¬åŒ–ä¸ºåˆ—å‘é‡ï¼Œç„¶åŽè¿›è¡Œè®¡ç®—ï¼Œä½†pytorchä¸­å•ç‹¬
 è®¾ç½®äº†ä¸€ä¸ªçŸ©é˜µå’Œå‘é‡ä¹˜çš„æ–¹æ³•ï¼Œä»Žè€Œç®€åŒ–äº†è¡Œ/åˆ—å‘é‡çš„ç†è§£è¿‡ç¨‹å’Œå°†
 å‘é‡è½¬åŒ–ä¸ºåˆ—å‘é‡çš„è½¬åŒ–è¿‡ç¨‹ã€‚
'''

# bmm æ‰¹é‡çŸ©é˜µçš„ç›¸ä¹˜ï¼Œæ¯”å¦‚ä¸‰ç»´çŸ©é˜µ
t5 = torch.arange(1, 13).reshape(3, 2, 2)
t6 = torch.arange(1, 19).reshape(3, 2, 3)

torch.bmm(t5, t6)

# çŸ©é˜µçš„ä»£æ•°è¿ç®—
'''
 torch.trace çŸ©é˜µçš„è¿¹
 .matrix_rank çŸ©é˜µçš„ç§©
 .det è®¡ç®—çŸ©é˜µçš„è¡Œåˆ—å¼
 .inverse çŸ©é˜µæ±‚é€†
 .lstsq æœ€å°äºŒä¹˜æ³• 
'''

# çŸ©é˜µçš„è¿¹
'''
è¿¹è¿ç®—å°±æ˜¯çŸ©é˜µå¯¹è§’çº¿å…ƒç´ ä¹‹å’Œï¼Œåœ¨pytorchä¸­ï¼Œå¯ä»¥ä½¿ç”¨traceå‡½æ•°å®Œæˆ
'''
a = torch.tensor([[1, 2], [3, 4]]).float()
print(torch.trace(a))

# çŸ©é˜µä¸ä¸€å®šéœ€è¦æ–¹é˜µ,å¦‚ä¸‹å³1+6
b = torch.arange(1, 7).reshape(2, 3)
print(torch.trace(b))

# çŸ©é˜µçš„ç§©ï¼ˆrankï¼‰
'''
æŒ‡çš„çŸ©é˜µä¸­è¡Œæˆ–è€…åˆ—çš„æžå¤§çº¿æ€§æ— å…³æ•°(è§†é¢‘35åˆ†é’Ÿå·¦å³)ï¼Œä¸”çŸ©é˜µä¸­è¡Œã€åˆ—æžå¤§æ— å…³æ•°æ€»æ˜¯ç›¸åŒçš„ï¼Œ
ä»»ä½•çŸ©é˜µçš„ç§©éƒ½æ˜¯å”¯ä¸€å€¼ï¼Œæ»¡ç§©æŒ‡çš„æ˜¯æ–¹é˜µï¼ˆè¡Œæ•°å’Œåˆ—æ•°ç›¸åŒçš„çŸ©é˜µï¼‰ä¸­è¡Œæ•°ã€åˆ—æ•°
å’Œç§©ç›¸åŒï¼Œæ»¡ç§©çŸ©é˜µæœ‰çº¿æ€§å”¯ä¸€è§£ç­‰é‡è¦ç‰¹æ€§ï¼Œè€Œå…¶ä»–çŸ©é˜µä¹Ÿèƒ½é€šè¿‡æ±‚è§£ç§©æ¥é™ç»´ï¼Œ
åŒæ—¶ï¼Œç§©ä¹Ÿæ˜¯å¥‡å¼‚å€¼åˆ†è§£ç­‰è¿ç®—ä¸­æ¶‰åŠåˆ°çš„é‡è¦æ¦‚å¿µã€‚

'''
a1 = torch.arange(1, 5).reshape(2, 2).float()
torch.matrix_rank(a1)
# å¯¹äºŽçŸ©é˜µb1ï¼Œç¬¬ä¸€åˆ—å’Œç¬¬äºŒåˆ—æ˜Žæ˜¾çº¿æ€§ç›¸å…³ï¼Œæœ€å¤§çº¿æ€§æ— å…³ç»„åªæœ‰1ç»„ï¼Œå› æ­¤
# çŸ©é˜µçš„ç§©è®¡ç®—ç»“æžœä¸º1
b1 = torch.tensor([[1, 2], [2, 4]]).float()
torch.matrix_rank(b1)

# çŸ©é˜µçš„è¡Œåˆ—å¼ï¼Œå¿…é¡»æ˜¯æ–¹é˜µ
# å›žé¡¾ï¼šå³ä»£æ•°ä½™å­å¼çš„æ±‚å’Œè¿‡ç¨‹
# ç”¨æ¥åŒºåˆ†å–å€¼ä¸º0å’Œä¸ä¸º0çš„è¡Œåˆ—å¼
# ä¸æ»¡ç§©çš„è¡Œåˆ—å¼ç»“æžœä¸º0ï¼Œå¦‚æžœæ˜¯0çš„è¯å°±æ— æ³•è®¡ç®—çŸ©é˜µçš„é€†çŸ©é˜µ
# å¤‡æ³¨å­¦ä¹ ç‚¹ï¼šå¯¹è§’çº¿æ³•è®¡ç®—è¡Œåˆ—å¼ï¼ˆè§†é¢‘43åˆ†ï¼‰

a2 = torch.tensor([[1, 2], [4, 5]]).float()
torch.det(a2)

# çº¿æ€§æ–¹ç¨‹ç»„çš„çŸ©é˜µè¡¨è¾¾å½¢å¼
'''
å›žé¡¾ï¼Œé€†çŸ©é˜µå®šä¹‰ï¼šå¦‚æžœå­˜åœ¨ä¸¤ä¸ªçŸ©é˜µAã€Bï¼Œå¹¶åœ¨çŸ©é˜µä¹˜æ³•è¿ç®—ä¸‹ï¼ŒA*B=Eï¼ˆå•ä½é˜µï¼‰
åˆ™æˆ‘ä»¬ç§°Aã€Bäº’ä¸ºé€†çŸ©é˜µã€‚
'''
a3 = torch.tensor([[1.0, 1], [3, 1]])
b3 = torch.tensor([2.0, 4])
torch.inverse(a3)
# é€†çŸ©é˜µå’Œæœ¬èº«ç›¸ä¹˜è¿”å›žå•ä½é˜µE ("1")
torch.mm(torch.inverse(a3), a3)

# æ¡ˆä¾‹ æ±‚è§£ ä¸€å…ƒäºŒæ¬¡æ–¹ç¨‹çº¿æ€§æ–¹ç¨‹ç»„ï¼Œè§†é¢‘ï¼ˆ55åˆ†ï¼‰
'''
A^-1 * A * x = A^-1 * B   PSï¼š A^-1 * A æ¶ˆæŽ‰ï¼Œå¾—å•ä½é˜µE
E * x = A^-1 * B
x = A^-1 * B
å³ ðŸ‘‡
'''
c = torch.mv(torch.inverse(a3), b3)
# cçš„å…ƒç´ ï¼Œå³æ˜¯å¯¹æ–¹ç¨‹ç³»æ•°çš„è§£ï¼Œå³ y=ax+bï¼Œä¸­çš„aå’Œbã€‚


# çŸ©é˜µçš„åˆ†è§£ ï¼ˆSVDåˆ†è§£/é™ç»´ï¼‰
'''
ä»»ä½•çŸ©é˜µA å¯ä»¥çœ‹æˆ   A = A * A^-1 * Aï¼Œä¹Ÿå¯ä»¥çœ‹æˆæŸç§æ„ä¹‰ä¸Šçš„åˆ†è§£ã€‚
å¤§å¤šæ•°å½¢å†µä¸‹ï¼ŒçŸ©é˜µåˆ†è§£ï¼šA = V * U * D
'''
# ç‰¹å¾åˆ†è§£
'''
ç‰¹å¾åˆ†è§£ä¸­ï¼ŒçŸ©é˜µåˆ†è§£å½¢å¼ä¸ºï¼š
    A = Q * Î» * Q^-1
å…¶ä¸­Qå’ŒQ^-1äº’ä¸ºé€†çŸ©é˜µï¼Œå¹¶ä¸”Qçš„åˆ—å°±æ˜¯Açš„ç‰¹å¾å€¼å¯¹åº”çš„ç‰¹å¾å‘é‡ï¼Œè€ŒÎ»ä¸ºçŸ©é˜µ
Açš„ç‰¹å¾å€¼æŒ‰ç…§é™åºæŽ’åˆ—ç»„æˆçš„å¯¹è§’çŸ©é˜µã€‚
torch.eigï¼šç‰¹å¾åˆ†è§£
'''
'''
ç‰¹å¾å€¼ï¼šçŸ©é˜µçš„ä¸€åˆ—æ‰€åŒ…å«çš„ä¿¡æ¯é‡ã€‚è§è§†é¢‘1å°æ—¶å¤„è®²è§£çš„eigå‡½æ•°éƒ¨åˆ†
'''
a4 = torch.arange(1, 10).reshape(3, 3).float()
# æ­¤å¤„eigenvectors=Trueä¼šè¿”å›žå®Œæ•´çš„ Q å’Œ Î»ã€‚
torch.eig(a4, eigenvectors=True)
# è¿”å›žç»“æžœä¸­ï¼Œeigenvaluesæ˜¯ç‰¹å¾å‘é‡ï¼Œå³AçŸ©é˜µåˆ†è§£åŽçš„Î»çŸ©é˜µçš„å¯¹è§’çº¿å…ƒç´ å€¼ã€‚
# eigenvectorsæ˜¯AçŸ©é˜µåˆ†è§£åŽçš„QçŸ©é˜µã€‚

b4 = torch.tensor([1, 2, 2, 4]).reshape(2, 2).float()
torch.matrix_rank(b4)
torch.eig(b4)

c1 = torch.tensor([[1, 2, 3], [2, 4, 6], [3, 6, 9]])
# ç‰¹å¾å€¼ç»“æžœ ç¬¬äºŒç¬¬ä¸‰ä¸ªå‡ ä¹ŽæŽ¥è¿‘äºŽ0ï¼Œå› æ­¤èƒ½å¤Ÿè¡¨ç¤ºï¼Œè¯¥çŸ©é˜µå…¶å®žç”¨ä¸€åˆ—çš„çº¿æ€§å…³ç³»å°±èƒ½æŠŠå…¶ä»–åˆ—è¡¨ç¤ºå‡ºæ¥ã€‚
# è¿™å°±æ˜¯ä¸ºäº†è¯†åˆ«å‡ºé«˜æœ‰æ•ˆçš„åˆ—ï¼ŒåŽé¢ç”¨äºŽé™ç»´->å¥‡å¼‚å€¼åˆ†è§£ï¼ˆSVDï¼‰
torch.eig(c1)
